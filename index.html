<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carnet d'Explorateur</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icone.png"> 
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <div id="app-container">
        
        <header>
            <h1>Carnet d'Explorateur IA</h1>
            <div id="boussole">üß≠</div> 
            
            <button id="btn-parametres">‚öôÔ∏è Param√®tres (Modules)</button>
        </header>

        <main>
            <div id="main-content-area">
                 <p>Bienvenue ! Veuillez cliquer sur **Param√®tres** et **Fermer & Enregistrer** pour tester la connexion et commencer votre exploration.</p>
            </div>
            
            <div id="dynamic-response-container" class="gemini-response" style="display:none;">
                <p><strong>R√©ponse de Gemini :</strong> <span id="dynamic-response-text"></span></p>
            </div>
        </main>
        
        <section id="saisie-utilisateur">
            <hr>
            <h2>Votre Question</h2>
            <form id="chat-form">
                <textarea id="user-input" rows="4" placeholder="Tapez votre question ici..."></textarea>
                <button type="submit" id="btn-envoyer">Envoyer √† Gemini</button>
            </form>
        </section>

    </div>

    <div id="modal-parametres" class="modal-cache">
        <div class="modal-contenu">
            <h2>‚öôÔ∏è R√©glages & Modules d'Exploration</h2>
            <p>Choisissez les fonctionnalit√©s que vous souhaitez activer pour votre session :</p>
            
            <div class="groupe-modules">
                <h3>Mode de Base</h3>
                <label>
                    <input type="checkbox" id="module-exploration" checked>
                    **Exploration Th√©matique** (Ex: Les lacs, les insectes)
                </label>
                <p class="description-module">Permet de lancer une √©tude sur un grand th√®me sans avoir besoin d'une photo pr√©cise.</p>
                
                <label>
                    <input type="checkbox" id="module-determination">
                    **D√©termination/Identification** (Via photo ou nom)
                </label>
                <p class="description-module">Permet d'identifier une esp√®ce ou un lieu pr√©cis √† partir d'une photo fournie.</p>
            </div>
            
            <button id="btn-fermer-modal">Fermer & Enregistrer</button>
        </div>
    </div>
    <script>
        // --- 1. CONFIGURATION DE BASE ---
        
        // ** CL√â API (Ins√©r√©e) **
        // ATTENTION : Cette cl√© est visible publiquement. Pour un vrai projet, utilisez un proxy serveur.
        const GEMINI_API_KEY = "AIzaSyDOh8ROg4wDKBBt3ur2mSjp4fM8ReVS5dE"; 
        
        // L'URL de l'API Gemini
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent";

        // DOM Elements
        const mainContentArea = document.getElementById('main-content-area');
        const dynamicResponseContainer = document.getElementById('dynamic-response-container');
        const dynamicResponseText = document.getElementById('dynamic-response-text');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const btnEnvoyer = document.getElementById('btn-envoyer');
        
        // --- 2. LOGIQUE DE L'INTERFACE (Ouverture/Fermeture Modale) ---
        
        const btnParametres = document.getElementById('btn-parametres');
        const modalParametres = document.getElementById('modal-parametres');
        const btnFermerModal = document.getElementById('btn-fermer-modal');

        // √âcouteur pour ouvrir la modale
        if(btnParametres) {
            btnParametres.addEventListener('click', () => {
                modalParametres.style.display = 'block';
                modalParametres.classList.remove('modal-cache');
            });
        }
        
        // √âcouteur pour fermer la modale et lancer le test API
        if(btnFermerModal) {
            btnFermerModal.addEventListener('click', () => {
                modalParametres.style.display = 'none';
                modalParametres.classList.add('modal-cache');
                // Lancement du test de connexion API
                testerConnexionGemini(); 
            });
        }

        // --- 3. LOGIQUE D'ENVOI DE NOUVELLE QUESTION ---

        if(chatForm) {
            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // Emp√™che le rechargement de la page
                const question = userInput.value.trim();

                if (question) {
                    // Masque la zone de test et affiche l'indicateur
                    mainContentArea.innerHTML = ''; 
                    dynamicResponseContainer.style.display = 'block';
                    dynamicResponseText.textContent = "Recherche en cours... Merci de patienter.";
                    btnEnvoyer.disabled = true;

                    // Envoi de la requ√™te
                    await envoyerRequeteGemini(question);
                    
                    // R√©active et vide l'input
                    btnEnvoyer.disabled = false;
                    userInput.value = '';
                }
            });
        }


        // --- 4. FONCTION PRINCIPALE D'APPEL GEMINI ---
        
        async function envoyerRequeteGemini(prompt) {
            console.log(`Envoi de la requ√™te pour : ${prompt}`);
            
            try {
                const response = await fetch(`${API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status} - ${response.statusText}`);
                }
                
                const data = await response.json();
                const reponseGemini = data.candidates[0].content.parts[0].text;
                
                // Affichage de la r√©ponse dynamique
                dynamicResponseText.textContent = reponseGemini;
                
            } catch (error) {
                // Affichage de l'erreur
                dynamicResponseText.innerHTML = `
                    <span style="color: red; font-weight: bold;">‚ùå ERREUR API :</span> ${error.message}
                `;
                console.error('Erreur lors de l‚Äôappel API Gemini:', error);
            }
        }


        // --- 5. FONCTION DE TEST GEMINI (Initial) ---
        
        function testerConnexionGemini() {
            const testPrompt = "Donne-moi une br√®ve anecdote scientifique sur l'√©rable en une phrase.";
            
            console.log("Tentative de connexion √† Gemini...");
            
            fetch(`${API_URL}?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{ role: "user", parts: [{ text: testPrompt }] }]
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status} - ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                const reponseGemini = data.candidates[0].content.parts[0].text;
                
                // Affichage du r√©sultat dans la zone principale (test)
                mainContentArea.innerHTML = `
                    <h2>‚úÖ Connexion R√©ussie !</h2>
                    <p><strong>Question :</strong> ${testPrompt}</p>
                    <p><strong>R√©ponse de Gemini :</strong> ${reponseGemini}</p>
                `;
                
                // Masque la zone de r√©ponse dynamique tant qu'aucune question n'est pos√©e
                dynamicResponseContainer.style.display = 'none';
            })
            .catch(error => {
                mainContentArea.innerHTML = `
                    <h2>‚ùå √âchec de la Connexion API</h2>
                    <p style="color: red;">
                        <strong>D√©tails :</strong> ${error.message}. <br>
                        V√©rifiez votre cl√© API ou l'√©tat du serveur.
                    </p>
                `;
                console.error('Erreur lors de l‚Äôappel API Gemini:', error);
            });
        }
    </script>
</body>
</html>

